
record(stringin, "CrS-C3S:Ctrl-PLC-01:ModVersionR") {
	field(DISP,	"1")
	field(VAL,	"$(MODVERSION=N/A)")
	field(PINI,	"YES")
}

record(stringin, "CrS-C3S:Ctrl-PLC-01:PLCFCommitR") {
	field(DISP,	"1")
#57d6ccfb5b3398d4eabe349cb1a1fa5fd455a1e1
	field(VAL,	"57d6ccfb5b3398d4eabe349cb1a1fa5fd455a1e")
	field(PINI,	"YES")
	info("plcf_commit", "57d6ccfb5b3398d4eabe349cb1a1fa5fd455a1e1")
}

#########################################################
########## EPICS <-> PLC connection management ##########
#########################################################
record(asyn, "CrS-C3S:Ctrl-PLC-01:iAsyn") {
	field(DTYP,	"asynRecordDevice")
	field(PORT,	"$(PLCNAME)")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:ModbusConnectedR") {
	field(DESC,	"Shows if the MODBUS channel connected")
	field(INP,	"CrS-C3S:Ctrl-PLC-01:iAsyn.CNCT CP")
	field(ONAM,	"Connected")
	field(ZNAM,	"Disconnected")
	field(ZSV,      "MAJOR")
	field(FLNK,	"CrS-C3S:Ctrl-PLC-01:CommsHashToPLCS")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:S7ConnectedR") {
	field(DESC,	"Shows if the S7 channel is connected")
	field(SCAN,	"I/O Intr")
	field(DTYP,	"S7plc stat")
	field(INP,	"@$(PLCNAME)")
	field(ONAM,	"Connected")
	field(ZNAM,	"Disconnected")
	field(ZSV,      "MAJOR")
}
record(calcout, "CrS-C3S:Ctrl-PLC-01:iCalcConn") {
	field(INPA,	"CrS-C3S:Ctrl-PLC-01:S7ConnectedR CP")
	field(INPB,	"CrS-C3S:Ctrl-PLC-01:ModbusConnectedR CP")
	field(CALC,	"A && B")
	field(OUT,	"CrS-C3S:Ctrl-PLC-01:ConnectedR PP")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:ConnectedR") {
	field(DESC,	"Shows if the PLC is connected")
	field(ONAM,	"Connected")
	field(ZNAM,	"Disconnected")
	field(ZSV,      "MAJOR")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR") {
	field(DESC,	"Shows if the comms hash is correct")
	field(ONAM,	"Correct")
	field(ZNAM,	"Incorrect")
	field(ZSV,      "MAJOR")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:AliveR") {
	alias("CrS-C3S:Ctrl-PLC-01:CommsOK")
	field(DESC,	"Shows if the PLC is sending heartbeats")
	field(ONAM,	"Alive")
	field(ZNAM,	"Not responding")
	field(ZSV,      "MAJOR")
}
record(calcout, "CrS-C3S:Ctrl-PLC-01:iCheckHash") {
	field(INPA,	"CrS-C3S:Ctrl-PLC-01:iCommsHashToPLC")
	field(INPB,	"CrS-C3S:Ctrl-PLC-01:CommsHashFromPLCR")
	field(INPC,	"CrS-C3S:Ctrl-PLC-01:CommsHashFromPLCR.STAT")
	field(CALC,	"A == B && C == 0")
	field(OOPT,	"On Change")
	field(OUT,	"CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR PP")
}
record(bi, "CrS-C3S:Ctrl-PLC-01:iOne") {
	field(DISP,	"1")
	field(PINI,	"YES")
	field(VAL,	"1")
}
record(bo, "CrS-C3S:Ctrl-PLC-01:iGotHeartbeat") {
	field(DOL,	"CrS-C3S:Ctrl-PLC-01:iOne")
	field(OMSL,	"closed_loop")
	field(OUT,	"CrS-C3S:Ctrl-PLC-01:iKickAlive PP")
}
record(bo, "CrS-C3S:Ctrl-PLC-01:iKickAlive") {
	field(HIGH,	"5")
	field(OUT,	"CrS-C3S:Ctrl-PLC-01:AliveR PP")
}

########################################################
########## EPICS -> PLC comms management data ##########
########################################################
record(ao, "CrS-C3S:Ctrl-PLC-01:iCommsHashToPLC") {
	field(DISP,	"1")
	field(PINI,	"YES")
	field(VAL,	"-1403542218")
}
record(ao, "CrS-C3S:Ctrl-PLC-01:CommsHashToPLCS") {
	field(DESC,	"Sends comms hash to PLC")
	field(SCAN,	"1 second")
	field(DTYP,	"asynInt32")
	field(OUT,	"@asyn($(PLCNAME)write, 0, 100)INT32_BE")
	field(OMSL,	"closed_loop")
	field(DOL,	"CrS-C3S:Ctrl-PLC-01:iCommsHashToPLC")
	field(DISV,	"0")
	field(SDIS,	"CrS-C3S:Ctrl-PLC-01:ModbusConnectedR")
}
record(calc, "CrS-C3S:Ctrl-PLC-01:iHeartbeatToPLC") {
	field(SCAN,	"1 second")
	field(INPA,	"CrS-C3S:Ctrl-PLC-01:iHeartbeatToPLC.VAL")
	field(CALC,	"(A >= 32000)? 0 : A + 1")
	field(FLNK,	"CrS-C3S:Ctrl-PLC-01:HeartbeatToPLCS")
	field(DISV,	"0")
	field(SDIS,	"CrS-C3S:Ctrl-PLC-01:ModbusConnectedR")
}
record(ao, "CrS-C3S:Ctrl-PLC-01:HeartbeatToPLCS") {
	field(DESC,	"Sends heartbeat to PLC")
	field(DTYP,	"asynInt32")
	field(OUT,	"@asyn($(PLCNAME)write, 2, 100)")
	field(OMSL,	"closed_loop")
	field(DOL,	"CrS-C3S:Ctrl-PLC-01:iHeartbeatToPLC.VAL")
	field(OIF,	"Full")
	field(DRVL,	"0")
	field(DRVH,	"32000")
	field(DISV,	"0")
	field(SDIS,	"CrS-C3S:Ctrl-PLC-01:ModbusConnectedR")
}

########################################################
########## PLC -> EPICS comms management data ##########
########################################################
record(ai, "CrS-C3S:Ctrl-PLC-01:CommsHashFromPLCR") {
	field(DESC,	"Comms hash from PLC")
	field(SCAN,	"I/O Intr")
	field(DTYP,	"S7plc")
	field(INP,	"@$(PLCNAME)/0 T=INT32")
	field(FLNK,	"CrS-C3S:Ctrl-PLC-01:iCheckHash")
}
record(ai, "CrS-C3S:Ctrl-PLC-01:HeartbeatFromPLCR") {
	field(DESC,	"Heartbeat from PLC")
	field(SCAN,	"I/O Intr")
	field(DTYP,	"S7plc")
	field(INP,	"@$(PLCNAME)/4 T=INT16")
	field(FLNK,	"CrS-C3S:Ctrl-PLC-01:iGotHeartbeat")
	field(DISS,	"INVALID")
	field(DISV,	"0")
	field(SDIS,	"CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
}


##########
########## CrS-C3S:Ctrl-PLC-01 ##########
##########
########## CommandWordsLength: 1
########## StatusWordsLength: 2
##########

###################################### SHC Systems ########################################
##############################  Safety Helium Collector System   ##########################
##                         			   PLC Control
##
##############################         Version: 1.0           #############################
#Author:  Saeed Haghtalab
#Date:    17-07-2018
#Version: v1.0


############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## CrS-C3S:Ctrl-PLC-01 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",                PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "OpMode_Manual")
}

#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",                  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_AutoBeam",         PV_DESC="Operation Mode Auto Beam",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:OpMode_AutoBeam")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto Beam")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "OpMode_AutoBeam")
}

#<<<--- add_digital("OpMode_AutoMaint",        PV_DESC="Operation Mode Auto Maintenance",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:OpMode_AutoMaint")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto Maintenance")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "OpMode_AutoMaint")
}


#<<<--- add_digital("Lock_OpMode",             PV_DESC="Lock Operation Mode",                  PV_ONAM="Locked",         PV_ZNAM="Unlocked")
record(bi, "CrS-C3S:Ctrl-PLC-01:Lock_OpMode")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Lock Operation Mode")
	field(ONAM, "Locked")
	field(ZNAM, "Unlocked")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Lock_OpMode")
}


#<<<--- add_digital("GlobalAlarm",             PV_DESC="Global Alarm",                         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:GlobalAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Global Alarm")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "GlobalAlarm")
}

#<<<--- add_digital("Simulation",              PV_DESC="Simulation Mode",                      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "CrS-C3S:Ctrl-PLC-01:Simulation")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/20 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Simulation Mode")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Simulation")
}


#<<<--- add_analog("GroupAlarmsCount",         "INT",                                          PV_DESC="Number of Group Alarms")
record(ai, "CrS-C3S:Ctrl-PLC-01:GroupAlarmsCount")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/22 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Number of Group Alarms")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "GroupAlarmsCount")
}




############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## CrS-C3S:Ctrl-PLC-01 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_LockOpModeOn",        PV_DESC="CMD: Turn Mode-Lock ON")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_LockOpModeOn")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Turn Mode-Lock ON")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_LockOpModeOn")
}

#<<<--- add_digital("Cmd_LockOpModeOff",       PV_DESC="CMD: Turn Mode-Lock OFF")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_LockOpModeOff")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Turn Mode-Lock OFF")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_LockOpModeOff")
}


#<<<--- add_digital("Cmd_OpModeManual",        PV_DESC="CMD: Manual Mode Operation")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_OpModeManual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode Operation")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_OpModeManual")
}

#<<<--- add_digital("Cmd_OpModeAuto",          PV_DESC="CMD: Auto Mode Operation")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_OpModeAuto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode Operation")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_OpModeAuto")
}

#<<<--- add_digital("Cmd_OpAutoBeam",          PV_DESC="CMD: Auto Beam Mode")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_OpAutoBeam")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Beam Mode")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_OpAutoBeam")
}

#<<<--- add_digital("Cmd_OpAutoMaint",         PV_DESC="CMD: Auto Maintenance Mode")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_OpAutoMaint")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Maintenance Mode")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_OpAutoMaint")
}


#<<<--- add_digital("Cmd_AutoAll",             PV_DESC="CMD: Change all valves to Auto mode")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_AutoAll")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Change all valves to Auto mode")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_AutoAll")
}


#<<<--- add_digital("Cmd_GlobalAlarmAck",      PV_DESC="CMD: Acknowledge all valve's Alarm")
record(bo, "CrS-C3S:Ctrl-PLC-01:Cmd_GlobalAlarmAck")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 10, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge all valve's Alarm")
	info("plc_datablock", "DEV_CrS-C3S:Ctrl-PLC-01_iDB")
	info("plc_variable", "Cmd_GlobalAlarmAck")
}




##########
########## HBL-010SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-010SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/24 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-010SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/26 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-010SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/28 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-010SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/30 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/30 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/30 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/30 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-010SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/32 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-010SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/36 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/40 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/40 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/40 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/40 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-010SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/42 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-010SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/46 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-010SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/50 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-010SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/54 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-010SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/58 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-010SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-010SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 11, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-010SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 12, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 14, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-010SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-010SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-010SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/62 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-010SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/64 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-010SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/66 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-010SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/68 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/68 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/68 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-010SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/68 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-010SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/70 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-010SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/74 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/78 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/78 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/78 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-010SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/78 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-010SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/80 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-010SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/84 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-010SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/88 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-010SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/92 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-010SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/96 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-010SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-010SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 16, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-010SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 17, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 19, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-010SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-020SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-020SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/100 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-020SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/102 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-020SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/104 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-020SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/106 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/106 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/106 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/106 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-020SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/108 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-020SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/112 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/116 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/116 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/116 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/116 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-020SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/118 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-020SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/122 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-020SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/126 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-020SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/130 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-020SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/134 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-020SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-020SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 21, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-020SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 22, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 24, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-020SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-020SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-020SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/138 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-020SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/140 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-020SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/142 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-020SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/144 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/144 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/144 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-020SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/144 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-020SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/146 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-020SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/150 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/154 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/154 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/154 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-020SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/154 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-020SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/156 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-020SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/160 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-020SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/164 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-020SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/168 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-020SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/172 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-020SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-020SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 26, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-020SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 27, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 29, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-020SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-030SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-030SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/176 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-030SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/178 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-030SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/180 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-030SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/182 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/182 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/182 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/182 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-030SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/184 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-030SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/188 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/192 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/192 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/192 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/192 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-030SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/194 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-030SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/198 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-030SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/202 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-030SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/206 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-030SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/210 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-030SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-030SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 31, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-030SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 32, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 34, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-030SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-030SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-030SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/214 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-030SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/216 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-030SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/218 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-030SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/220 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/220 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/220 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-030SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/220 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-030SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/222 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-030SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/226 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/230 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/230 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/230 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-030SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/230 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-030SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/232 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-030SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/236 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-030SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/240 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-030SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/244 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-030SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/248 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-030SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-030SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 36, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-030SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 37, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 39, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-030SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-040SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-040SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/252 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-040SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/254 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-040SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/256 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-040SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/258 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/258 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/258 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/258 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-040SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/260 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-040SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/264 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/268 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/268 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/268 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/268 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-040SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/270 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-040SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/274 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-040SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/278 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-040SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/282 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-040SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/286 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-040SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-040SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 41, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-040SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 42, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 44, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-040SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-040SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-040SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/290 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-040SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/292 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-040SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/294 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-040SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/296 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/296 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/296 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-040SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/296 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-040SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/298 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-040SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/302 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/306 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/306 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/306 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-040SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/306 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-040SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/308 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-040SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/312 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-040SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/316 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-040SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/320 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-040SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/324 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-040SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-040SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 46, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-040SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 47, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 49, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-040SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-050SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-050SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/328 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-050SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/330 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-050SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/332 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-050SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/334 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/334 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/334 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/334 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-050SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/336 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-050SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/340 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/344 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/344 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/344 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/344 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-050SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/346 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-050SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/350 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-050SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/354 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-050SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/358 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-050SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/362 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-050SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-050SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 51, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-050SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 52, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 54, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-050SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-050SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-050SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/366 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-050SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/368 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-050SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/370 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-050SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/372 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/372 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/372 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-050SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/372 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-050SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/374 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-050SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/378 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/382 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/382 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/382 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-050SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/382 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-050SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/384 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-050SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/388 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-050SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/392 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-050SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/396 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-050SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/400 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-050SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-050SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 56, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-050SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 57, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 59, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-050SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-060SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-060SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/404 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-060SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/406 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-060SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/408 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-060SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/410 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/410 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/410 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/410 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-060SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/412 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-060SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/416 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/420 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/420 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/420 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/420 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-060SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/422 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-060SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/426 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-060SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/430 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-060SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/434 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-060SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/438 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-060SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-060SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 61, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-060SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 62, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 64, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-060SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-060SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-060SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/442 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-060SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/444 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-060SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/446 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-060SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/448 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/448 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/448 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-060SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/448 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-060SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/450 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-060SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/454 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/458 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/458 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/458 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-060SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/458 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-060SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/460 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-060SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/464 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-060SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/468 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-060SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/472 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-060SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/476 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-060SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-060SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 66, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-060SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 67, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 69, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-060SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-070SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-070SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/480 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-070SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/482 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-070SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/484 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-070SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/486 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/486 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/486 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/486 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-070SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/488 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-070SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/492 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/496 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/496 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/496 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/496 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-070SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/498 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-070SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/502 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-070SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/506 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-070SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/510 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-070SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/514 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-070SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-070SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 71, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-070SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 72, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 74, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-070SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-070SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-070SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/518 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-070SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/520 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-070SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/522 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-070SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/524 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/524 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/524 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-070SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/524 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-070SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/526 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-070SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/530 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/534 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/534 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/534 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-070SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/534 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-070SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/536 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-070SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/540 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-070SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/544 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-070SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/548 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-070SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/552 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-070SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-070SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 76, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-070SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 77, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 79, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-070SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-080SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-080SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/556 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-080SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/558 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-080SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/560 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-080SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/562 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/562 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/562 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/562 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-080SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/564 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-080SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/568 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/572 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/572 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/572 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/572 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-080SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/574 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-080SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/578 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-080SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/582 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-080SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/586 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-080SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/590 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-080SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-080SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 81, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-080SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 82, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 84, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-080SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-080SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-080SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/594 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-080SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/596 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-080SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/598 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-080SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/600 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/600 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/600 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-080SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/600 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-080SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/602 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-080SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/606 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/610 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/610 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/610 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-080SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/610 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-080SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/612 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-080SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/616 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-080SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/620 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-080SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/624 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-080SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/628 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-080SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-080SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 86, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-080SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 87, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 89, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-080SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-090SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-090SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/632 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-090SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/634 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-090SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/636 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-090SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/638 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/638 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/638 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/638 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-090SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/640 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-090SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/644 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/648 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/648 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/648 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/648 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-090SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/650 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-090SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/654 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-090SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/658 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-090SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/662 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-090SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/666 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-090SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-090SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 91, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-090SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 92, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 94, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-090SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-090SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-090SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/670 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-090SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/672 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-090SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/674 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-090SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/676 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/676 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/676 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-090SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/676 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-090SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/678 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-090SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/682 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/686 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/686 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/686 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-090SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/686 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-090SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/688 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-090SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/692 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-090SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/696 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-090SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/700 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-090SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/704 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-090SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-090SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 96, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-090SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 97, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 99, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-090SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-100SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-100SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/708 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-100SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/710 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-100SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/712 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-100SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/714 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/714 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/714 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/714 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-100SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/716 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-100SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/720 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/724 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/724 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/724 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/724 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-100SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/726 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-100SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/730 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-100SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/734 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-100SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/738 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-100SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/742 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-100SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-100SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 101, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-100SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-100SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 102, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-100SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 104, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-100SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-100SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-100SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-100SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-100SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/746 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-100SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/748 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-100SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/750 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-100SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/752 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/752 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/752 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-100SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/752 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-100SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/754 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-100SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/758 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/762 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/762 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/762 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-100SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/762 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-100SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/764 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-100SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/768 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-100SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/772 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-100SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/776 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-100SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/780 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-100SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-100SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 106, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-100SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-100SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 107, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-100SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 109, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-100SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-100SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-100SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-110SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-110SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/784 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-110SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/786 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-110SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/788 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-110SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/790 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/790 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/790 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/790 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-110SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/792 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-110SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/796 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/800 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/800 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/800 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/800 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-110SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/802 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-110SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/806 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-110SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/810 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-110SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/814 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-110SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/818 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-110SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-110SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 111, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-110SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-110SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 112, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-110SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 114, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-110SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-110SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-110SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-110SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-110SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/822 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-110SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/824 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-110SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/826 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-110SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/828 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/828 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/828 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-110SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/828 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-110SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/830 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-110SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/834 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/838 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/838 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/838 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-110SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/838 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-110SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/840 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-110SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/844 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-110SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/848 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-110SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/852 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-110SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/856 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-110SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-110SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 116, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-110SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-110SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 117, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-110SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 119, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-110SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-110SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-110SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-120SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-120SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/860 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-120SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/862 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-120SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/864 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-120SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/866 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/866 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/866 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/866 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-120SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/868 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-120SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/872 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/876 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/876 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/876 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/876 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-120SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/878 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-120SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/882 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-120SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/886 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-120SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/890 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-120SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/894 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-120SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-120SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 121, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-120SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-120SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 122, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-120SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 124, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-120SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-120SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-120SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-120SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-120SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/898 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-120SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/900 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-120SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/902 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-120SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/904 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/904 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/904 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-120SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/904 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-120SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/906 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-120SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/910 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/914 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/914 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/914 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-120SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/914 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-120SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/916 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-120SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/920 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-120SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/924 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-120SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/928 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-120SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/932 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-120SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-120SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 126, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-120SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-120SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 127, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-120SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 129, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-120SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-120SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-120SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-130SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-130SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/936 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-130SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/938 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-130SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/940 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-130SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/942 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/942 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/942 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/942 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-130SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/944 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-130SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/948 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/952 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/952 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/952 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/952 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-130SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/954 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-130SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/958 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-130SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/962 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-130SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/966 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-130SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/970 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-130SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-130SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 131, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-130SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-130SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 132, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-130SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 134, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-130SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-130SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-130SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-130SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-130SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/974 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-130SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/976 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-130SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/978 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-130SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/980 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/980 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/980 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-130SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/980 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-130SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/982 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-130SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/986 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/990 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/990 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/990 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-130SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/990 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-130SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/992 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-130SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/996 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-130SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1000 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-130SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1004 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-130SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1008 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-130SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-130SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 136, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-130SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-130SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 137, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-130SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 139, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-130SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-130SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-130SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-140SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-140SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1012 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-140SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1014 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-140SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1016 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-140SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1018 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1018 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1018 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1018 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-140SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1020 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-140SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1024 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1028 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1028 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1028 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1028 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-140SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1030 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-140SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1034 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-140SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1038 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-140SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1042 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-140SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1046 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-140SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-140SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 141, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-140SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-140SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 142, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-140SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 144, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-140SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-140SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-140SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-140SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-140SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1050 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-140SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1052 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-140SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1054 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-140SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1056 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1056 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1056 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-140SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1056 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-140SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1058 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-140SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1062 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1066 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1066 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1066 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-140SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1066 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-140SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1068 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-140SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1072 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-140SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1076 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-140SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1080 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-140SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1084 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-140SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-140SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 146, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-140SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-140SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 147, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-140SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 149, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-140SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-140SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-140SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-140SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-150SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-150SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1088 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-150SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1090 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-150SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1092 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-150SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1094 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1094 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1094 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1094 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-150SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1096 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-150SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1100 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1104 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1104 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1104 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1104 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-150SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1106 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-150SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1110 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-150SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1114 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-150SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1118 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-150SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1122 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-150SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-150SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 151, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-150SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-150SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 152, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-150SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 154, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-150SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-150SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-150SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-150SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-150SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1126 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-150SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1128 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-150SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1130 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-150SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1132 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1132 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1132 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-150SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1132 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-150SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1134 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-150SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1138 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1142 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1142 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1142 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-150SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1142 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-150SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1144 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-150SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1148 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-150SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1152 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-150SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1156 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-150SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1160 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-150SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-150SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 156, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-150SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-150SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 157, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-150SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 159, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-150SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-150SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-150SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-150SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-160SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-160SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1164 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-160SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1166 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-160SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1168 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-160SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1170 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1170 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1170 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1170 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-160SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1172 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-160SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1176 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1180 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1180 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1180 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1180 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-160SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1182 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-160SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1186 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-160SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1190 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-160SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1194 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-160SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1198 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-160SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-160SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 161, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-160SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-160SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 162, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-160SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 164, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-160SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-160SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-160SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-160SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-160SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1202 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-160SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1204 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-160SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1206 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-160SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1208 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1208 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1208 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-160SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1208 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-160SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1210 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-160SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1214 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1218 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1218 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1218 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-160SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1218 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-160SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1220 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-160SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1224 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-160SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1228 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-160SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1232 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-160SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1236 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-160SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-160SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 166, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-160SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-160SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 167, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-160SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 169, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-160SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-160SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-160SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-160SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-170SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-170SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1240 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-170SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1242 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-170SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1244 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-170SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1246 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1246 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1246 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1246 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-170SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1248 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-170SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1252 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1256 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1256 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1256 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1256 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-170SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1258 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-170SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1262 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-170SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1266 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-170SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1270 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-170SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1274 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-170SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-170SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 171, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-170SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-170SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 172, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-170SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 174, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-170SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-170SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-170SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-170SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-170SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1278 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-170SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1280 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-170SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1282 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-170SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1284 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1284 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1284 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-170SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1284 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-170SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1286 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-170SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1290 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1294 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1294 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1294 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-170SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1294 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-170SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1296 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-170SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1300 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-170SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1304 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-170SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1308 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-170SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1312 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-170SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-170SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 176, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-170SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-170SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 177, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-170SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 179, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-170SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-170SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-170SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-170SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-180SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-180SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1316 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-180SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1318 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-180SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1320 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-180SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1322 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1322 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1322 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1322 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-180SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1324 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-180SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1328 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1332 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1332 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1332 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1332 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-180SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1334 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-180SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1338 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-180SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1342 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-180SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1346 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-180SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1350 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-180SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-180SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 181, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-180SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-180SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 182, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-180SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 184, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-180SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-180SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-180SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-180SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-180SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1354 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-180SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1356 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-180SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1358 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-180SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1360 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1360 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1360 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-180SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1360 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-180SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1362 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-180SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1366 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1370 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1370 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1370 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-180SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1370 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-180SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1372 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-180SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1376 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-180SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1380 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-180SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1384 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-180SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1388 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-180SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-180SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 186, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-180SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-180SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 187, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-180SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 189, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-180SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-180SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-180SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-180SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-190SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-190SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1392 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-190SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1394 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-190SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1396 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-190SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1398 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1398 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1398 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1398 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-190SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1400 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-190SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1404 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1408 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1408 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1408 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1408 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-190SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1410 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-190SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1414 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-190SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1418 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-190SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1422 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-190SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1426 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-190SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-190SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 191, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-190SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-190SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 192, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-190SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 194, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-190SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-190SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-190SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-190SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-190SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1430 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-190SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1432 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-190SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1434 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-190SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1436 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1436 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1436 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-190SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1436 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-190SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1438 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-190SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1442 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1446 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1446 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1446 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-190SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1446 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-190SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1448 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-190SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1452 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-190SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1456 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-190SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1460 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-190SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1464 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-190SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-190SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 196, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-190SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-190SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 197, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-190SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 199, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-190SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-190SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-190SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-190SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-200SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-200SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1468 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-200SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1470 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-200SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1472 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-200SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1474 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1474 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1474 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1474 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-200SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1476 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-200SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1480 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1484 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1484 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1484 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1484 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-200SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1486 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-200SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1490 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-200SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1494 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-200SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1498 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-200SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1502 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-200SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-200SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 201, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-200SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-200SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 202, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-200SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 204, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-200SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-200SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-200SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-200SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-200SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1506 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-200SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1508 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-200SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1510 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-200SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1512 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1512 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1512 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-200SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1512 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-200SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1514 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-200SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1518 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1522 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1522 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1522 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-200SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1522 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-200SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1524 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-200SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1528 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-200SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1532 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-200SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1536 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-200SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1540 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-200SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-200SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 206, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-200SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-200SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 207, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-200SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 209, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-200SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-200SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-200SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-200SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## HBL-210SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-210SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1544 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-210SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1546 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-210SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1548 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-210SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1550 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1550 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1550 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1550 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-210SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1552 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-210SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1556 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1560 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1560 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1560 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1560 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-210SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1562 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-210SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1566 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-210SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1570 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-210SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1574 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-210SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1578 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-210SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-210SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 211, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-210SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-210SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 212, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-210SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 214, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-210SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "HBL-210SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "HBL-210SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## HBL-210SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## HBL-210SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1582 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "HBL-210SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1584 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "HBL-210SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1586 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "HBL-210SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1588 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1588 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1588 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "HBL-210SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1588 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "HBL-210SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1590 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "HBL-210SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1594 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1598 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1598 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1598 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "HBL-210SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1598 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "HBL-210SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1600 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "HBL-210SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1604 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "HBL-210SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1608 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "HBL-210SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1612 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "HBL-210SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1616 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## HBL-210SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "HBL-210SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 216, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## HBL-210SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "HBL-210SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 217, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "HBL-210SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 219, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_HBL-210SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "HBL-210SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "HBL-210SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "HBL-210SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-010SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-010SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1620 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-010SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1622 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-010SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1624 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-010SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1626 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1626 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1626 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1626 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-010SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1628 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-010SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1632 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1636 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1636 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1636 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1636 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-010SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1638 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-010SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1642 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-010SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1646 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-010SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1650 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-010SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1654 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-010SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-010SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 221, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-010SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 222, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 224, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-010SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-010SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-010SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1658 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-010SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1660 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-010SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1662 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-010SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1664 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1664 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1664 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-010SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1664 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-010SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1666 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-010SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1670 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1674 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1674 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1674 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-010SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1674 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-010SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1676 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-010SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1680 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-010SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1684 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-010SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1688 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-010SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1692 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-010SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-010SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 226, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-010SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 227, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 229, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-010SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-020SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-020SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1696 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-020SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1698 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-020SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1700 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-020SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1702 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1702 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1702 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1702 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-020SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1704 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-020SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1708 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1712 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1712 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1712 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1712 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-020SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1714 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-020SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1718 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-020SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1722 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-020SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1726 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-020SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1730 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-020SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-020SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 231, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-020SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 232, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 234, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-020SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-020SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-020SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1734 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-020SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1736 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-020SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1738 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-020SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1740 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1740 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1740 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-020SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1740 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-020SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1742 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-020SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1746 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1750 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1750 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1750 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-020SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1750 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-020SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1752 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-020SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1756 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-020SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1760 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-020SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1764 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-020SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1768 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-020SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-020SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 236, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-020SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 237, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 239, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-020SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-030SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-030SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1772 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-030SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1774 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-030SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1776 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-030SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1778 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1778 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1778 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1778 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-030SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1780 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-030SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1784 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1788 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1788 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1788 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1788 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-030SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1790 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-030SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1794 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-030SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1798 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-030SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1802 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-030SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1806 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-030SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-030SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 241, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-030SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 242, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 244, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-030SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-030SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-030SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1810 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-030SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1812 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-030SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1814 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-030SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1816 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1816 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1816 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-030SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1816 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-030SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1818 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-030SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1822 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1826 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1826 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1826 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-030SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1826 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-030SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1828 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-030SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1832 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-030SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1836 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-030SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1840 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-030SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1844 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-030SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-030SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 246, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-030SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 247, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 249, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-030SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-040SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-040SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1848 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-040SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1850 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-040SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1852 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-040SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1854 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1854 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1854 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1854 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-040SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1856 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-040SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1860 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1864 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1864 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1864 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1864 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-040SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1866 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-040SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1870 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-040SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1874 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-040SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1878 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-040SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1882 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-040SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-040SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 251, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-040SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 252, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 254, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-040SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-040SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-040SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1886 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-040SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1888 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-040SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1890 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-040SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1892 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1892 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1892 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-040SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1892 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-040SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1894 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-040SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1898 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1902 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1902 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1902 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-040SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1902 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-040SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1904 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-040SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1908 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-040SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1912 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-040SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1916 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-040SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1920 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-040SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-040SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 256, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-040SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 257, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 259, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-040SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-050SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-050SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1924 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-050SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1926 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-050SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1928 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-050SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1930 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1930 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1930 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1930 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-050SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1932 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-050SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1936 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1940 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1940 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1940 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1940 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-050SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1942 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-050SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1946 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-050SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1950 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-050SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1954 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-050SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1958 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-050SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-050SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 261, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-050SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 262, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 264, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-050SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-050SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-050SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1962 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-050SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1964 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-050SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1966 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-050SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1968 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1968 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1968 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-050SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1968 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-050SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1970 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-050SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1974 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1978 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1978 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1978 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-050SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1978 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-050SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1980 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-050SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1984 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-050SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1988 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-050SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1992 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-050SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/1996 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-050SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-050SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 266, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-050SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 267, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 269, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-050SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-060SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-060SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2000 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-060SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2002 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-060SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2004 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-060SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2006 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2006 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2006 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2006 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-060SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2008 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-060SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2012 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2016 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2016 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2016 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2016 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-060SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2018 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-060SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2022 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-060SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2026 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-060SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2030 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-060SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2034 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-060SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-060SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 271, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-060SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 272, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 274, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-060SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-060SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-060SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2038 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-060SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2040 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-060SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2042 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-060SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2044 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2044 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2044 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-060SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2044 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-060SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2046 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-060SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2050 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2054 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2054 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2054 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-060SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2054 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-060SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2056 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-060SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2060 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-060SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2064 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-060SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2068 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-060SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2072 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-060SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-060SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 276, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-060SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 277, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 279, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-060SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-070SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-070SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2076 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-070SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2078 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-070SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2080 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-070SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2082 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2082 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2082 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2082 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-070SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2084 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-070SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2088 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2092 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2092 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2092 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2092 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-070SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2094 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-070SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2098 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-070SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2102 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-070SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2106 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-070SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2110 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-070SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-070SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 281, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-070SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 282, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 284, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-070SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-070SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-070SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2114 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-070SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2116 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-070SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2118 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-070SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2120 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2120 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2120 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-070SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2120 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-070SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2122 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-070SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2126 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2130 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2130 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2130 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-070SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2130 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-070SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2132 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-070SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2136 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-070SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2140 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-070SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2144 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-070SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2148 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-070SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-070SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 286, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-070SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 287, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 289, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-070SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-080SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-080SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2152 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-080SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2154 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-080SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2156 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-080SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2158 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2158 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2158 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2158 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-080SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2160 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-080SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2164 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2168 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2168 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2168 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2168 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-080SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2170 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-080SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2174 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-080SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2178 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-080SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2182 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-080SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2186 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-080SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-080SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 291, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-080SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 292, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 294, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-080SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-080SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-080SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2190 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-080SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2192 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-080SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2194 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-080SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2196 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2196 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2196 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-080SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2196 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-080SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2198 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-080SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2202 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2206 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2206 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2206 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-080SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2206 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-080SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2208 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-080SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2212 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-080SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2216 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-080SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2220 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-080SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2224 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-080SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-080SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 296, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-080SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 297, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 299, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-080SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## MBL-090SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-090SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2228 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-090SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2230 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-090SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2232 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-090SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2234 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2234 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2234 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2234 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-090SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2236 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-090SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2240 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2244 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2244 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2244 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2244 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-090SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2246 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-090SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2250 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-090SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2254 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-090SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2258 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-090SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2262 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-090SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-090SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 301, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-090SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 302, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 304, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-090SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "MBL-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "MBL-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## MBL-090SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## MBL-090SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2266 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "MBL-090SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2268 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "MBL-090SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2270 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "MBL-090SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2272 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2272 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2272 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "MBL-090SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2272 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "MBL-090SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2274 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "MBL-090SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2278 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2282 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2282 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2282 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "MBL-090SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2282 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "MBL-090SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2284 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "MBL-090SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2288 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "MBL-090SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2292 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "MBL-090SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2296 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "MBL-090SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2300 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## MBL-090SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "MBL-090SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 306, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## MBL-090SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "MBL-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 307, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "MBL-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 309, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_MBL-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "MBL-090SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "MBL-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "MBL-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-010SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-010SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2304 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-010SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2306 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-010SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2308 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-010SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2310 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2310 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2310 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2310 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-010SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2312 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-010SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2316 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2320 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2320 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2320 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2320 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-010SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2322 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-010SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2326 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-010SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2330 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-010SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2334 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-010SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2338 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-010SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-010SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 311, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-010SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 312, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 314, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-010SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-010SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-010SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-010SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-010SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2342 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-010SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2344 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-010SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2346 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-010SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2348 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2348 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2348 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-010SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2348 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-010SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2350 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-010SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2354 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2358 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2358 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2358 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-010SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2358 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-010SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2360 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-010SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2364 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-010SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2368 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-010SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2372 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-010SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2376 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-010SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-010SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 316, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-010SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 317, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 319, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-010SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-010SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-010SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-010SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-020SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-020SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2380 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-020SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2382 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-020SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2384 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-020SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2386 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2386 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2386 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2386 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-020SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2388 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-020SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2392 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2396 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2396 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2396 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2396 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-020SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2398 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-020SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2402 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-020SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2406 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-020SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2410 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-020SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2414 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-020SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-020SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 321, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-020SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 322, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 324, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-020SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-020SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-020SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-020SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-020SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2418 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-020SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2420 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-020SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2422 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-020SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2424 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2424 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2424 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-020SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2424 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-020SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2426 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-020SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2430 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2434 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2434 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2434 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-020SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2434 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-020SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2436 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-020SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2440 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-020SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2444 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-020SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2448 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-020SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2452 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-020SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-020SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 326, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-020SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 327, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 329, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-020SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-020SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-020SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-020SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-030SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-030SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2456 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-030SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2458 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-030SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2460 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-030SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2462 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2462 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2462 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2462 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-030SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2464 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-030SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2468 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2472 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2472 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2472 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2472 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-030SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2474 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-030SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2478 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-030SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2482 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-030SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2486 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-030SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2490 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-030SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-030SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 331, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-030SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 332, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 334, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-030SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-030SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-030SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-030SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-030SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2494 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-030SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2496 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-030SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2498 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-030SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2500 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2500 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2500 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-030SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2500 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-030SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2502 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-030SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2506 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2510 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2510 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2510 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-030SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2510 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-030SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2512 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-030SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2516 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-030SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2520 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-030SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2524 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-030SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2528 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-030SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-030SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 336, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-030SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 337, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 339, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-030SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-030SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-030SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-030SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-040SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-040SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2532 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-040SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2534 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-040SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2536 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-040SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2538 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2538 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2538 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2538 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-040SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2540 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-040SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2544 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2548 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2548 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2548 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2548 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-040SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2550 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-040SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2554 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-040SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2558 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-040SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2562 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-040SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2566 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-040SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-040SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 341, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-040SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 342, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 344, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-040SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-040SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-040SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-040SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-040SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2570 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-040SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2572 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-040SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2574 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-040SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2576 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2576 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2576 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-040SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2576 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-040SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2578 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-040SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2582 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2586 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2586 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2586 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-040SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2586 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-040SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2588 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-040SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2592 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-040SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2596 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-040SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2600 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-040SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2604 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-040SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-040SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 346, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-040SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 347, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 349, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-040SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-040SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-040SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-040SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-050SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-050SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2608 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-050SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2610 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-050SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2612 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-050SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2614 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2614 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2614 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2614 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-050SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2616 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-050SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2620 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2624 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2624 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2624 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2624 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-050SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2626 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-050SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2630 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-050SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2634 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-050SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2638 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-050SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2642 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-050SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-050SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 351, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-050SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 352, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 354, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-050SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-050SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-050SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-050SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-050SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2646 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-050SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2648 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-050SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2650 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-050SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2652 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2652 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2652 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-050SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2652 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-050SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2654 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-050SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2658 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2662 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2662 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2662 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-050SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2662 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-050SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2664 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-050SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2668 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-050SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2672 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-050SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2676 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-050SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2680 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-050SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-050SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 356, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-050SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 357, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 359, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-050SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-050SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-050SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-050SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-060SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-060SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2684 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-060SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2686 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-060SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2688 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-060SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2690 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2690 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2690 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2690 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-060SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2692 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-060SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2696 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2700 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2700 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2700 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2700 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-060SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2702 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-060SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2706 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-060SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2710 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-060SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2714 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-060SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2718 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-060SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-060SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 361, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-060SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 362, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 364, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-060SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-060SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-060SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-060SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-060SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2722 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-060SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2724 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-060SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2726 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-060SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2728 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2728 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2728 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-060SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2728 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-060SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2730 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-060SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2734 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2738 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2738 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2738 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-060SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2738 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-060SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2740 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-060SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2744 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-060SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2748 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-060SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2752 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-060SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2756 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-060SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-060SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 366, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-060SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 367, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 369, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-060SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-060SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-060SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-060SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-070SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-070SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2760 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-070SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2762 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-070SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2764 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-070SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2766 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2766 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2766 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2766 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-070SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2768 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-070SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2772 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2776 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2776 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2776 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2776 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-070SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2778 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-070SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2782 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-070SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2786 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-070SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2790 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-070SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2794 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-070SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-070SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 371, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-070SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 372, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 374, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-070SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-070SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-070SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-070SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-070SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2798 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-070SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2800 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-070SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2802 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-070SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2804 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2804 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2804 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-070SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2804 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-070SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2806 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-070SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2810 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2814 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2814 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2814 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-070SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2814 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-070SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2816 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-070SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2820 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-070SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2824 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-070SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2828 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-070SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2832 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-070SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-070SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 376, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-070SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 377, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 379, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-070SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-070SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-070SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-070SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-080SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-080SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2836 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-080SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2838 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-080SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2840 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-080SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2842 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2842 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2842 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2842 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-080SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2844 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-080SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2848 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2852 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2852 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2852 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2852 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-080SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2854 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-080SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2858 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-080SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2862 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-080SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2866 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-080SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2870 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-080SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-080SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 381, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-080SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 382, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 384, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-080SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-080SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-080SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-080SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-080SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2874 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-080SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2876 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-080SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2878 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-080SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2880 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2880 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2880 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-080SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2880 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-080SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2882 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-080SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2886 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2890 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2890 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2890 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-080SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2890 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-080SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2892 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-080SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2896 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-080SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2900 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-080SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2904 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-080SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2908 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-080SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-080SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 386, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-080SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 387, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 389, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-080SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-080SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-080SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-080SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-090SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-090SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2912 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-090SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2914 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-090SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2916 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-090SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2918 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2918 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2918 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2918 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-090SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2920 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-090SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2924 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2928 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2928 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2928 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2928 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-090SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2930 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-090SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2934 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-090SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2938 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-090SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2942 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-090SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2946 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-090SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-090SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 391, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-090SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 392, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 394, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-090SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-090SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-090SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-090SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-090SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2950 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-090SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2952 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-090SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2954 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-090SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2956 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2956 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2956 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-090SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2956 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-090SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2958 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-090SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2962 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2966 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2966 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2966 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-090SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2966 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-090SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2968 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-090SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2972 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-090SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2976 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-090SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2980 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-090SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2984 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-090SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-090SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 396, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-090SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 397, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 399, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-090SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-090SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-090SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-090SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-100SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-100SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2988 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-100SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2990 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-100SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2992 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-100SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2994 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2994 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2994 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2994 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-100SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/2996 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-100SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3000 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3004 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3004 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3004 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3004 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-100SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3006 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-100SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3010 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-100SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3014 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-100SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3018 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-100SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3022 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-100SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-100SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 401, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-100SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-100SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 402, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-100SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 404, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-100SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-100SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-100SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-100SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-100SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3026 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-100SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3028 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-100SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3030 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-100SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3032 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3032 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3032 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-100SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3032 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-100SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3034 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-100SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3038 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3042 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3042 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3042 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-100SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3042 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-100SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3044 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-100SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3048 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-100SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3052 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-100SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3056 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-100SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3060 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-100SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-100SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 406, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-100SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-100SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 407, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-100SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 409, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-100SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-100SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-100SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-100SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-110SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-110SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3064 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-110SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3066 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-110SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3068 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-110SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3070 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3070 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3070 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3070 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-110SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3072 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-110SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3076 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3080 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3080 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3080 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3080 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-110SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3082 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-110SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3086 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-110SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3090 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-110SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3094 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-110SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3098 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-110SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-110SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 411, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-110SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-110SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 412, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-110SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 414, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-110SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-110SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-110SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-110SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-110SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3102 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-110SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3104 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-110SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3106 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-110SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3108 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3108 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3108 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-110SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3108 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-110SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3110 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-110SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3114 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3118 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3118 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3118 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-110SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3118 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-110SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3120 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-110SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3124 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-110SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3128 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-110SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3132 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-110SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3136 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-110SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-110SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 416, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-110SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-110SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 417, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-110SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 419, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-110SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-110SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-110SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-110SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-120SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-120SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3140 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-120SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3142 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-120SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3144 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-120SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3146 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3146 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3146 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3146 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-120SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3148 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-120SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3152 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3156 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3156 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3156 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3156 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-120SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3158 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-120SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3162 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-120SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3166 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-120SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3170 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-120SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3174 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-120SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-120SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 421, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-120SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-120SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 422, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-120SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 424, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-120SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-120SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-120SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-120SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-120SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3178 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-120SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3180 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-120SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3182 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-120SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3184 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3184 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3184 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-120SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3184 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-120SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3186 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-120SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3190 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3194 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3194 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3194 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-120SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3194 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-120SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3196 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-120SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3200 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-120SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3204 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-120SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3208 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-120SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3212 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-120SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-120SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 426, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-120SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-120SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 427, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-120SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 429, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-120SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-120SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-120SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-120SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



##########
########## Spk-130SHC:Cryo-PV-55090 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-130SHC:Cryo-PV-55090 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3216 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-130SHC:Cryo-PV-55090:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3218 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-130SHC:Cryo-PV-55090:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3220 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-130SHC:Cryo-PV-55090:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3222 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3222 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3222 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55090:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3222 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-130SHC:Cryo-PV-55090:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3224 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-130SHC:Cryo-PV-55090:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3228 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55090:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3232 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55090:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3232 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55090:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3232 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55090:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3232 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-130SHC:Cryo-PV-55090:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3234 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-130SHC:Cryo-PV-55090:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3238 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-130SHC:Cryo-PV-55090:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3242 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-130SHC:Cryo-PV-55090:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3246 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-130SHC:Cryo-PV-55090:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3250 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-130SHC:Cryo-PV-55090 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-130SHC:Cryo-PV-55090:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 431, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-130SHC:Cryo-PV-55090 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-130SHC:Cryo-PV-55090:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 432, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-130SHC:Cryo-PV-55090:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 434, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55090_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-130SHC:Cryo-PV-55090:UploadParametersS") {
	field(LNK1, "Spk-130SHC:Cryo-PV-55090:P_Faceplate_LockID")
	field(LNK2, "Spk-130SHC:Cryo-PV-55090:P_BlockIcon_LockID")
}



##########
########## Spk-130SHC:Cryo-PV-55091 ##########
##########
########## CommandWordsLength: 1
########## ParameterWordsLength: 4
########## StatusWordsLength: 19
##########

###################################### Cryo Systems ########################################
##############################  Cryogenics Moderator System   ##############################
##                         CrS-CMS:CRYO: PV - Remote On/Off valve
##
############################         Version: 1.2             ######################################
#Author:  Miklos Boros
#Date:    28-02-2019
#Version: v1.2
#Changes:
#1. Major review,
#2. Indent,  unit standardization
############################         Version: 1.1             ######################################
#Author:  Miklos Boros, Marino Vojneski
#Date:    12-06-2018
#Version: v1.1
#Changes:
#1. Modified Alarm Signal section to be compatible with new format.
############################ Version: 1.0             ######################################
#Author:  Miklos Boros
#Date:    08-01-2018
#Version: v1.0



############################
#STATUS BLOCK
############################
#<<<--- define_status_block()

##########
########## Spk-130SHC:Cryo-PV-55091 PLC   -> EPICS status   ##########
##########

#Operation modes
#<<<--- add_digital("OpMode_Auto",             PV_DESC="Operation Mode Auto",      PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:OpMode_Auto")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Auto")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Auto")
}

#<<<--- add_digital("OpMode_Manual",           PV_DESC="Operation Mode Manual",    PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:OpMode_Manual")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Operation Mode Manual")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpMode_Manual")
}


#Valve physical states
#<<<--- add_digital("Opened",                  PV_DESC="Valve Opened",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:Opened")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Opened")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opened")
}

#<<<--- add_digital("Closed",                  PV_DESC="Valve Closed",             PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:Closed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve Closed")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closed")
}

#<<<--- add_digital("Opening",                 PV_DESC="Valve is opening",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:Opening")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=4")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is opening")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening")
}

#<<<--- add_digital("Closing",                 PV_DESC="Valve is closing",         PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:Closing")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=5")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Valve is closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing")
}

#<<<--- add_digital("Moving",                  PV_DESC="Opening OR Closing",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:Moving")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=6")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Opening OR Closing")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Moving")
}


#<<<--- add_digital("OpenSolenoid",            PV_DESC="Open Solenoid energized",  PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:OpenSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=7")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Open Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpenSolenoid")
}

#<<<--- add_digital("CloseSolenoid",           PV_DESC="Close Solenoid energized", PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:CloseSolenoid")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3254 T=UINT16 B=8")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Close Solenoid energized")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "CloseSolenoid")
}


#<<<--- add_analog("ValveColor",               "INT",                              PV_DESC="BlockIcon valve color")
record(ai, "Spk-130SHC:Cryo-PV-55091:ValveColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3256 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon valve color")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ValveColor")
}

#<<<--- add_analog("SolenoidColor",            "INT",                              PV_DESC="BlockIcon solenoid color")
record(ai, "Spk-130SHC:Cryo-PV-55091:SolenoidColor")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3258 T=INT16")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "BlockIcon solenoid color")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolenoidColor")
}


#Inhibit signals (set by the PLC code, can't be changed by the OPI)
#<<<--- add_digital("Inhibit_Lock",            PV_DESC="Inhibit Locking",          PV_ONAM="InhibitLocking", PV_ZNAM="AllowLocking")
record(bi, "Spk-130SHC:Cryo-PV-55091:Inhibit_Lock")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3260 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Inhibit Locking")
	field(ONAM, "InhibitLocking")
	field(ZNAM, "AllowLocking")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Inhibit_Lock")
}



#for OPI visualisation
#<<<--- add_digital("EnableAutoBtn",           PV_DESC="Enable Auto Button",       PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:EnableAutoBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3260 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Auto Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableAutoBtn")
}

#<<<--- add_digital("EnableManualBtn",         PV_DESC="Enable Manual Button",     PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:EnableManualBtn")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3260 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Enable Manual Button")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "EnableManualBtn")
}


#Locking mechanism
#<<<--- add_digital("DevLocked",               PV_DESC="Device Locked",            PV_ONAM="True",           PV_ZNAM="False")
record(bi, "Spk-130SHC:Cryo-PV-55091:DevLocked")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3260 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device Locked")
	field(ONAM, "True")
	field(ZNAM, "False")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "DevLocked")
}

#<<<--- add_analog("Faceplate_LockID",         "DINT",                             PV_DESC="Owner Lock ID")
record(ai, "Spk-130SHC:Cryo-PV-55091:Faceplate_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3262 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Owner Lock ID")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Faceplate_LockID")
}

#<<<--- add_analog("BlockIcon_LockID",         "DINT",                             PV_DESC="Guest Lock ID")
record(ai, "Spk-130SHC:Cryo-PV-55091:BlockIcon_LockID")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3266 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Guest Lock ID")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "BlockIcon_LockID")
}


#Alarm signals
#<<<--- add_major_alarm("GroupAlarm",          "Group Alarm",                      PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55091:GroupAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3270 T=UINT16 B=0")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Group Alarm")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "GroupAlarm")
}

#<<<--- add_major_alarm("Opening_TimeOut",     "Opening Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55091:Opening_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3270 T=UINT16 B=1")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Opening Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Opening_TimeOut")
}

#<<<--- add_major_alarm("Closing_TimeOut",     "Closing Time Out",                 PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55091:Closing_TimeOut")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3270 T=UINT16 B=2")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Closing Time Out")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Closing_TimeOut")
}

#<<<--- add_major_alarm("LimitSwitchAlarm",    "Both limit switches hit",          PV_ZNAM="NominalState")
record(bi, "Spk-130SHC:Cryo-PV-55091:LimitSwitchAlarm")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3270 T=UINT16 B=3")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(ONAM, "Both limit switches hit")
	field(OSV,  "MAJOR")
	field(ZNAM, "NominalState")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "LimitSwitchAlarm")
}



#OPI timeouts
#<<<--- add_time("OpeningTimeThreshold",       PV_DESC="Maximum Opening Time")
record(ai, "Spk-130SHC:Cryo-PV-55091:OpeningTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3272 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeThreshold")
}

#<<<--- add_time("ClosingTimeThreshold",       PV_DESC="Maximum Closing Time")
record(ai, "Spk-130SHC:Cryo-PV-55091:ClosingTimeThreshold")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3276 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Maximum Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeThreshold")
}

#<<<--- add_time("OpeningTimeElapsed",         PV_DESC="Elapsed Opening Time")
record(ai, "Spk-130SHC:Cryo-PV-55091:OpeningTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3280 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Opening Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "OpeningTimeElapsed")
}

#<<<--- add_time("ClosingTimeElapsed",         PV_DESC="Elapsed Closing Time")
record(ai, "Spk-130SHC:Cryo-PV-55091:ClosingTimeElapsed")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3284 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Elapsed Closing Time")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "ClosingTimeElapsed")
}


#<<<--- add_time("SolPulseDuration",           PV_DESC="Solenoid Pulse Duration")
record(ai, "Spk-130SHC:Cryo-PV-55091:SolPulseDuration")
{
	field(SCAN, "I/O Intr")
	field(DTYP, "S7plc")
	field(INP,  "@$(PLCNAME)/3288 T=INT32")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Solenoid Pulse Duration")
	field(EGU,  "ms")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "SolPulseDuration")
}



############################
#COMMAND BLOCK
############################
#<<<--- define_command_block()

##########
########## Spk-130SHC:Cryo-PV-55091 EPICS -> PLC commands   ##########
##########

#OPI buttons
#<<<--- add_digital("Cmd_Auto",                PV_DESC="CMD: Auto Mode")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_Auto")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0001, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Auto Mode")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Auto")
}

#<<<--- add_digital("Cmd_Manual",              PV_DESC="CMD: Manual Mode")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_Manual")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0002, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Mode")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_Manual")
}

#<<<--- add_digital("Cmd_ManuOpen",            PV_DESC="CMD: Manual Open")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_ManuOpen")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0004, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Open")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuOpen")
}

#<<<--- add_digital("Cmd_ManuClose",           PV_DESC="CMD: Manual Close")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_ManuClose")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0008, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Manual Close")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ManuClose")
}



#<<<--- add_digital("Cmd_AckAlarm",            PV_DESC="CMD: Acknowledge Alarm")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_AckAlarm")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0010, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Acknowledge Alarm")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_AckAlarm")
}


#<<<--- add_digital("Cmd_ForceUnlock",         PV_DESC="CMD: Force Unlock Device")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_ForceUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0020, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Force Unlock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_ForceUnlock")
}

#<<<--- add_digital("Cmd_DevLock",             PV_DESC="CMD: Lock Device")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_DevLock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0040, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Lock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevLock")
}

#<<<--- add_digital("Cmd_DevUnlock",           PV_DESC="CMD: Unlock Device")
record(bo, "Spk-130SHC:Cryo-PV-55091:Cmd_DevUnlock")
{
	field(DTYP, "asynUInt32Digital")
	field(OUT,  "@asynMask($(PLCNAME)write, 436, 0x0080, 100)")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "CMD: Unlock Device")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "Cmd_DevUnlock")
}


############################
#PARAMETER BLOCK
############################
#<<<--- define_parameter_block()

##########
########## Spk-130SHC:Cryo-PV-55091 EPICS -> PLC parameters ##########
##########

#Locking mechanism
#<<<--- add_analog("P_Faceplate_LockID",       "DINT",                          PV_DESC="Device ID after Lock")
record(ao, "Spk-130SHC:Cryo-PV-55091:P_Faceplate_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 437, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Lock")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_Faceplate_LockID")
	info(autosaveFields_pass0, "VAL")
}

#<<<--- add_analog("P_BlockIcon_LockID",       "DINT",                          PV_DESC="Device ID after Blockicon Open")
record(ao, "Spk-130SHC:Cryo-PV-55091:P_BlockIcon_LockID")
{
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn($(PLCNAME)write, 439, 100)INT32_BE")
	field(DISS, "INVALID")
	field(DISV, "0")
	field(SDIS, "CrS-C3S:Ctrl-PLC-01:PLCHashCorrectR")
	field(DESC, "Device ID after Blockicon Open")
	field(DRVH, "2147483647")
	field(DRVL, "-2147483648")
	info("plc_datablock", "DEV_Spk-130SHC:Cryo-PV-55091_iDB")
	info("plc_variable", "P_BlockIcon_LockID")
	info(autosaveFields_pass0, "VAL")
}

record(fanout, "Spk-130SHC:Cryo-PV-55091:UploadParametersS") {
	field(LNK1, "Spk-130SHC:Cryo-PV-55091:P_Faceplate_LockID")
	field(LNK2, "Spk-130SHC:Cryo-PV-55091:P_BlockIcon_LockID")
}



record(fanout, "CrS-C3S:Ctrl-PLC-01:UploadParametersS") {
	field(LNK1, "HBL-010SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "HBL-010SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "HBL-020SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "HBL-020SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "HBL-030SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS1-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS1-FO") {
	field(LNK1, "HBL-030SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "HBL-040SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "HBL-040SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "HBL-050SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "HBL-050SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS2-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS2-FO") {
	field(LNK1, "HBL-060SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "HBL-060SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "HBL-070SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "HBL-070SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "HBL-080SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS3-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS3-FO") {
	field(LNK1, "HBL-080SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "HBL-090SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "HBL-090SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "HBL-100SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "HBL-100SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS4-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS4-FO") {
	field(LNK1, "HBL-110SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "HBL-110SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "HBL-120SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "HBL-120SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "HBL-130SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS5-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS5-FO") {
	field(LNK1, "HBL-130SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "HBL-140SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "HBL-140SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "HBL-150SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "HBL-150SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS6-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS6-FO") {
	field(LNK1, "HBL-160SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "HBL-160SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "HBL-170SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "HBL-170SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "HBL-180SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS7-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS7-FO") {
	field(LNK1, "HBL-180SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "HBL-190SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "HBL-190SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "HBL-200SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "HBL-200SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS8-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS8-FO") {
	field(LNK1, "HBL-210SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "HBL-210SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "MBL-010SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "MBL-010SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "MBL-020SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS9-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS9-FO") {
	field(LNK1, "MBL-020SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "MBL-030SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "MBL-030SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "MBL-040SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "MBL-040SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS10-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS10-FO") {
	field(LNK1, "MBL-050SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "MBL-050SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "MBL-060SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "MBL-060SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "MBL-070SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS11-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS11-FO") {
	field(LNK1, "MBL-070SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "MBL-080SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "MBL-080SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "MBL-090SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "MBL-090SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS12-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS12-FO") {
	field(LNK1, "Spk-010SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "Spk-010SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "Spk-020SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "Spk-020SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "Spk-030SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS13-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS13-FO") {
	field(LNK1, "Spk-030SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "Spk-040SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "Spk-040SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "Spk-050SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "Spk-050SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS14-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS14-FO") {
	field(LNK1, "Spk-060SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "Spk-060SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "Spk-070SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "Spk-070SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "Spk-080SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS15-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS15-FO") {
	field(LNK1, "Spk-080SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK2, "Spk-090SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK3, "Spk-090SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK4, "Spk-100SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK5, "Spk-100SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS16-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS16-FO") {
	field(LNK1, "Spk-110SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK2, "Spk-110SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK3, "Spk-120SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK4, "Spk-120SHC:Cryo-PV-55091:UploadParametersS")
	field(LNK5, "Spk-130SHC:Cryo-PV-55090:UploadParametersS")
	field(LNK6, "CrS-C3S:Ctrl-PLC-01:_UploadParamS17-FO")
}
record(fanout, "CrS-C3S:Ctrl-PLC-01:_UploadParamS17-FO") {
	field(LNK1, "Spk-130SHC:Cryo-PV-55091:UploadParametersS")
}
